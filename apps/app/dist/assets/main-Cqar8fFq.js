(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const r of l.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&a(r)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function a(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}})();console.log(typeof PluginMessageHandler<"u"?"Running as R1 Creation - Enhanced Rabbit Flashlight":"Running in browser mode - Enhanced Rabbit Flashlight");let n={brightness:100,color:"#ffffff",isColorMenuOpen:!1,isIntroComplete:!1,isMainInterfaceActive:!1};const u=[10,25,50,75,100];let d=4,v;function N(){const e=document.getElementById("introScreen"),t=document.getElementById("mainInterface");e.classList.remove("fade-out"),t.classList.remove("active"),v=setTimeout(()=>{S()},3e3)}function S(){const e=document.getElementById("introScreen"),t=document.getElementById("mainInterface"),i=document.getElementById("brightnessControls");e.classList.add("fade-out"),setTimeout(()=>{t.classList.add("active"),n.isMainInterfaceActive=!0,setTimeout(()=>{i.classList.add("visible")},400),B()},400),n.isIntroComplete=!0,h()}function E(){v&&clearTimeout(v),S()}function L(){const e=document.getElementById("colorWheel"),t=e.getContext("2d"),i=e.width/2,a=e.height/2,s=e.width/2-10,l=s*.3;t.clearRect(0,0,e.width,e.height);for(let o=l;o<=s;o+=2)for(let c=0;c<360;c+=2){const p=(c-1)*Math.PI/180,y=(c+1)*Math.PI/180,g=Math.min(100,(o-l)/(s-l)*100);t.beginPath(),t.arc(i,a,o,p,y),t.lineWidth=3,t.strokeStyle=`hsl(${c}, ${g}%, 50%)`,t.stroke()}let r=!1;const m=o=>{const c=e.getBoundingClientRect(),p=o.clientX||o.touches&&o.touches[0].clientX,y=o.clientY||o.touches&&o.touches[0].clientY,g=p-c.left-i,w=y-c.top-a,b=Math.sqrt(g*g+w*w);if(b>=l&&b<=s){const R=(Math.atan2(w,g)*180/Math.PI+360)%360,F=Math.min(100,(b-l)/(s-l)*100),D=`hsl(${R}, ${F}%, 50%)`;I(D);const M=document.getElementById("colorWheelCenter");M.classList.add("active"),setTimeout(()=>{M.classList.remove("active")},200)}};e.addEventListener("mousedown",o=>{r=!0,m(o)}),e.addEventListener("mousemove",o=>{r&&m(o)}),e.addEventListener("mouseup",()=>{r=!1}),e.addEventListener("touchstart",o=>{o.preventDefault(),r=!0,m(o)}),e.addEventListener("touchmove",o=>{o.preventDefault(),r&&m(o)}),e.addEventListener("touchend",o=>{o.preventDefault(),r=!1})}function I(e){n.color=e,document.body.style.backgroundColor=e,document.body.style.transition="background-color 0.3s cubic-bezier(0.4, 0, 0.2, 1)",h(),console.log("Flashlight color changed to:",e),typeof PluginMessageHandler<"u"&&PluginMessageHandler.postMessage(JSON.stringify({message:`Flashlight color changed to ${e}`,timestamp:Date.now()}))}function f(e){n.brightness=e;const t=document.getElementById("flashlightOverlay"),i=document.getElementById("brightnessValue");t&&(t.className="flashlight-overlay",e<=10?t.classList.add("dim-90"):e<=25?t.classList.add("dim-75"):e<=50?t.classList.add("dim-50"):e<=75?t.classList.add("dim-25"):t.classList.add("dim-0")),i&&(i.textContent=e+"%",i.classList.add("pulse"),setTimeout(()=>{i.classList.remove("pulse")},300));const a=u.indexOf(e);if(a!==-1){d=a;const s=document.getElementById("brightnessSlider");s&&(s.value=a)}h(),console.log("Brightness set to:",e+"%"),typeof PluginMessageHandler<"u"&&PluginMessageHandler.postMessage(JSON.stringify({message:`Brightness adjusted to ${e}%`,timestamp:Date.now()}))}function T(){d<u.length-1&&(d++,f(u[d]),O("up"))}function A(){d>0&&(d--,f(u[d]),O("down"))}function O(e){const t=document.getElementById("brightnessControls");if(t){const i=e==="up"?"scale(1.05)":"scale(0.95)";t.style.transform=`translateX(-50%) ${i}`,setTimeout(()=>{t.style.transform="translateX(-50%) translateY(0)"},150)}}function B(){I(n.color),f(n.brightness),n.isColorMenuOpen&&P()}window.addEventListener("scrollUp",()=>{if(!n.isIntroComplete){E();return}console.log("Scroll up detected - increasing brightness"),T()});window.addEventListener("scrollDown",()=>{if(!n.isIntroComplete){E();return}console.log("Scroll down detected - decreasing brightness"),A()});window.addEventListener("sideClick",()=>{if(!n.isIntroComplete){E();return}console.log("Side button clicked - toggling color menu"),H()});window.addEventListener("longPressStart",()=>{if(!n.isIntroComplete)return;console.log("Long press started - preparing reset");const e=document.getElementById("flashlightOverlay");e&&(e.style.background="radial-gradient(circle, rgba(254,95,0,0.2) 0%, rgba(0,0,0,0) 70%)")});window.addEventListener("longPressEnd",()=>{if(!n.isIntroComplete)return;console.log("Long press ended - resetting to white flashlight"),I("#ffffff"),f(100),n.isColorMenuOpen&&C();const e=document.getElementById("flashlightOverlay");e&&(e.style.background=""),typeof PluginMessageHandler<"u"&&PluginMessageHandler.postMessage(JSON.stringify({message:"Flashlight reset to white at 100% brightness",wantsR1Response:!0}))});function H(){n.isColorMenuOpen?C():P()}function P(){const e=document.getElementById("colorMenu");e&&(e.classList.add("visible"),n.isColorMenuOpen=!0,setTimeout(()=>{L()},100)),h(),console.log("Color menu opened")}function C(){const e=document.getElementById("colorMenu");e&&(e.classList.remove("visible"),n.isColorMenuOpen=!1),h(),console.log("Color menu closed")}window.onPluginMessage=function(e){if(console.log("Received plugin message:",e),e.data)try{const t=typeof e.data=="string"?JSON.parse(e.data):e.data;console.log("Parsed data:",t)}catch{console.log("Data as text:",e.data)}e.message&&console.log("Message text:",e.message)};async function h(){if(window.creationStorage)try{const e=btoa(JSON.stringify(n));await window.creationStorage.plain.setItem("flashlight_state",e),console.log("Flashlight state saved")}catch(e){console.error("Error saving flashlight state:",e)}else localStorage.setItem("flashlight_state",JSON.stringify(n))}async function x(){if(window.creationStorage)try{const e=await window.creationStorage.plain.getItem("flashlight_state");if(e){const t=JSON.parse(atob(e));return n={...n,...t},console.log("Flashlight state loaded:",n),n}}catch(e){console.error("Error loading flashlight state:",e)}else{const e=localStorage.getItem("flashlight_state");if(e){const t=JSON.parse(e);return n={...n,...t},console.log("Flashlight state loaded from localStorage:",n),n}}return n}document.addEventListener("DOMContentLoaded",async()=>{if(console.log("Enhanced Rabbit Flashlight initialized!"),await x(),n.isIntroComplete){const e=document.getElementById("introScreen"),t=document.getElementById("mainInterface"),i=document.getElementById("brightnessControls");e.style.display="none",t.classList.add("active"),i.classList.add("visible"),n.isMainInterfaceActive=!0,J()}else N();typeof PluginMessageHandler>"u"&&window.addEventListener("keydown",e=>{e.code==="Space"&&(e.preventDefault(),window.dispatchEvent(new CustomEvent("sideClick"))),e.code==="ArrowUp"&&(e.preventDefault(),window.dispatchEvent(new CustomEvent("scrollUp"))),e.code==="ArrowDown"&&(e.preventDefault(),window.dispatchEvent(new CustomEvent("scrollDown"))),e.code==="Escape"&&(e.preventDefault(),n.isColorMenuOpen&&C())})});function J(){L();const e=document.getElementById("brightnessSlider");e&&(e.addEventListener("input",t=>{const i=parseInt(t.target.value);d=i,f(u[i])}),e.addEventListener("touchstart",()=>{e.style.transform="scale(1.05)"}),e.addEventListener("touchend",()=>{e.style.transform="scale(1)"})),setTimeout(()=>{B()},100),typeof PluginMessageHandler<"u"&&PluginMessageHandler.postMessage(JSON.stringify({message:"Enhanced Rabbit Flashlight ready! Scroll wheel: brightness, side button: colors, long press: reset.",wantsR1Response:!0})),console.log("Main interface initialized successfully")}console.log("ðŸ”¦ Enhanced Rabbit Flashlight Ready!");console.log("âœ¨ Features:");console.log("- Intro screen with smooth transitions");console.log("- Hardware-like brightness dimming");console.log("- Enhanced color wheel with touch responsiveness");console.log("- Compact brightness controls");console.log("- Smooth animations throughout");console.log("- Persistent state management");console.log("");console.log("ðŸŽ® Controls:");console.log("- Scroll wheel: Adjust brightness (10%, 25%, 50%, 75%, 100%)");console.log("- Side button: Toggle color wheel menu");console.log("- Long press side button: Reset to white at 100%");console.log("- Tap/drag color wheel: Change flashlight color");console.log("- Bottom slider: Manual brightness control");console.log("- Any input during intro: Skip to main interface");console.log("");console.log("ðŸŽ¨ by Atomlabor.de - Optimized for Rabbit R1 OS 2");
